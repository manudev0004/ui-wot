<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactored UI Toggle Demo</title>
    <script type="module" src="/build/ui-wot-components.esm.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            background: #f8fafc;
        }
        
        .demo-section {
            background: white;
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .demo-grid {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .code-block {
            background: #1a1a1a;
            color: #e5e5e5;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }
        
        h1, h2 { color: #1e293b; }
        h2 { border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; }
        
        .unified-event-demo {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        
        .event-log {
            background: #fafafa;
            border: 1px solid #e5e7eb;
            padding: 1rem;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <h1>üîÑ Refactored UI Toggle Demo</h1>
    <p>This demo showcases the cleaned-up ui-toggle component with unified events and the new ui-property-card smart wrapper.</p>

    <!-- Basic Toggle Examples -->
    <section class="demo-section">
        <h2>1. Basic Refactored Toggle</h2>
        <p>Clean, minimal API with only essential props:</p>
        
        <div class="demo-grid">
            <div>
                <h3>Standard Toggle</h3>
                <ui-toggle id="basic-toggle" value="false" label="Simple Toggle"></ui-toggle>
            </div>
            
            <div>
                <h3>Different Variants</h3>
                <ui-toggle value="true" variant="circle" label="Circle (default)" size="md"></ui-toggle><br><br>
                <ui-toggle value="true" variant="square" label="Square" size="md"></ui-toggle><br><br>
                <ui-toggle value="true" variant="apple" label="Apple Style" size="md"></ui-toggle><br><br>
                <ui-toggle value="false" variant="cross" label="Cross Style" size="md"></ui-toggle>
            </div>
            
            <div>
                <h3>Different Sizes</h3>
                <ui-toggle value="true" size="sm" label="Small"></ui-toggle><br><br>
                <ui-toggle value="true" size="md" label="Medium"></ui-toggle><br><br>
                <ui-toggle value="true" size="lg" label="Large"></ui-toggle>
            </div>
        </div>
    </section>

    <!-- Unified Event Demo -->
    <section class="demo-section">
        <h2>2. Unified Event System</h2>
        <p>All components now emit standardized <code>UiMsg</code> events:</p>
        
        <div class="unified-event-demo">
            <ui-toggle id="event-demo-toggle" value="false" label="Toggle me to see events"></ui-toggle>
            
            <div class="event-log" id="event-log">
                <div style="color: #666;">Event log (valueMsg events):</div>
            </div>
        </div>

        <div class="code-block">
// New unified event format:
toggle.addEventListener('valueMsg', (e) => {
  console.log('Payload:', e.detail.payload);    // true/false
  console.log('Previous:', e.detail.prev);      // previous value
  console.log('Timestamp:', e.detail.ts);       // timestamp
  console.log('Source:', e.detail.source);      // component id
  console.log('Success:', e.detail.ok);         // operation success
});

// Simple API methods:
await toggle.setValue(true);
const value = await toggle.getValue();
        </div>
    </section>

    <!-- Smart Wrapper Demo -->
    <section class="demo-section">
        <h2>3. Smart Wrapper (ui-property-card)</h2>
        <p>Visual feedback, status indicators, and TD integration:</p>
        
        <div class="demo-grid">
            <ui-property-card 
                id="smart-card-1"
                thing-id="demo-thing" 
                property="power" 
                label="Smart Light"
                description="Living room ceiling light with dimming capability"
                variant="default">
                <ui-toggle slot="control" id="smart-toggle-1" value="false"></ui-toggle>
            </ui-property-card>
            
            <ui-property-card 
                id="smart-card-2"
                thing-id="demo-thing" 
                property="brightness" 
                label="Brightness Control"
                description="Adjust the light brightness level"
                variant="compact">
                <ui-toggle slot="control" id="smart-toggle-2" value="true" variant="apple"></ui-toggle>
            </ui-property-card>
        </div>
        
        <div style="margin-top: 1rem;">
            <button onclick="simulateSuccess()" style="background: #10b981; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; margin-right: 0.5rem;">
                Simulate Success
            </button>
            <button onclick="simulateError()" style="background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; margin-right: 0.5rem;">
                Simulate Error
            </button>
            <button onclick="simulatePending()" style="background: #3b82f6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px;">
                Simulate Pending
            </button>
        </div>
    </section>

    <!-- API Demo -->
    <section class="demo-section">
        <h2>4. Programmatic API</h2>
        <p>Clean, Promise-based methods:</p>
        
        <ui-toggle id="api-demo-toggle" value="false" label="API Demo Toggle"></ui-toggle>
        
        <div style="margin-top: 1rem;">
            <button onclick="setValue(true)" style="background: #10b981; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; margin-right: 0.5rem;">
                Set True
            </button>
            <button onclick="setValue(false)" style="background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; margin-right: 0.5rem;">
                Set False
            </button>
            <button onclick="getValue()" style="background: #3b82f6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px;">
                Get Value
            </button>
        </div>
        
        <div id="api-result" style="margin-top: 1rem; padding: 0.5rem; background: #f3f4f6; border-radius: 4px; font-family: monospace;"></div>
    </section>

    <!-- Comparison -->
    <section class="demo-section">
        <h2>5. Before vs After Comparison</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div>
                <h3 style="color: #dc2626;">‚ùå Before (Bloated)</h3>
                <div class="code-block">
&lt;ui-toggle 
  td-url="http://device/prop/on"
  state="active"
  reactive="true"
  debounce="200"
  sync-interval="5000"
  mirror="#other-toggle"
  mode="readwrite"
  debug="true"
  dark="true"
  keyboard="true"&gt;
&lt;/ui-toggle&gt;

// Multiple confusing events
toggle.addEventListener('valueChange', ...);
toggle.addEventListener('toggle', ...);
toggle.addEventListener('syncRequest', ...);
                </div>
            </div>
            
            <div>
                <h3 style="color: #059669;">‚úÖ After (Clean)</h3>
                <div class="code-block">
&lt;ui-property-card 
  thing-id="device" 
  property="on"
  label="Smart Light"&gt;
  &lt;ui-toggle 
    slot="control" 
    value="true" 
    variant="primary" 
    size="md"&gt;
  &lt;/ui-toggle&gt;
&lt;/ui-property-card&gt;

// One unified event
toggle.addEventListener('valueMsg', ...);
                </div>
            </div>
        </div>
    </section>

    <script>
        // Unified event demo
        const eventDemoToggle = document.getElementById('event-demo-toggle');
        const eventLog = document.getElementById('event-log');
        
        eventDemoToggle.addEventListener('valueMsg', (e) => {
            const msg = e.detail;
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `
                <div style="border-bottom: 1px solid #eee; padding: 0.25rem 0; margin-bottom: 0.25rem;">
                    <strong>valueMsg:</strong> ${JSON.stringify({
                        payload: msg.payload,
                        prev: msg.prev,
                        ts: new Date(msg.ts).toLocaleTimeString(),
                        source: msg.source,
                        ok: msg.ok
                    }, null, 2)}
                </div>
            `;
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        });

        // Smart wrapper demos
        const smartCard1 = document.getElementById('smart-card-1');
        const smartCard2 = document.getElementById('smart-card-2');
        
        // Listen to property actions from smart wrappers
        document.addEventListener('propertyAction', (e) => {
            console.log('Property action:', e.detail);
            const card = e.target;
            
            // Simulate async operation
            setTimeout(async () => {
                if (Math.random() > 0.3) {
                    await card.ackSuccess('Value updated successfully');
                } else {
                    await card.reportError('Network error: Could not update property');
                }
            }, 1500);
        });

        // Status simulation functions
        async function simulateSuccess() {
            await smartCard1.ackSuccess('Operation completed successfully');
        }
        
        async function simulateError() {
            await smartCard1.reportError('Failed to connect to device');
        }
        
        async function simulatePending() {
            await smartCard1.setStatus('pending', 'Connecting to device...');
            
            setTimeout(async () => {
                await smartCard1.ackSuccess('Connected');
            }, 3000);
        }

        // API demo functions
        const apiToggle = document.getElementById('api-demo-toggle');
        const apiResult = document.getElementById('api-result');
        
        async function setValue(value) {
            const result = await apiToggle.setValue(value);
            apiResult.textContent = `setValue(${value}) returned: ${result}`;
        }
        
        async function getValue() {
            const value = await apiToggle.getValue();
            apiResult.textContent = `getValue() returned: ${value}`;
        }

        // Show current timestamp
        document.addEventListener('DOMContentLoaded', () => {
            const now = new Date().toLocaleString();
            console.log(`Demo loaded at: ${now}`);
        });
    </script>
</body>
</html>
