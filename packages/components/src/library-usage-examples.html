<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UI-WoT Library Usage Examples</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .example-section {
      margin: 40px 0;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }
    .code-block {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      margin: 10px 0;
    }
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-success { background: #4ade80; }
    .status-error { background: #f87171; }
    .status-warning { background: #fbbf24; }
    .status-pending { background: #94a3b8; }
  </style>
</head>
<body>
  <header>
    <h1>üåê UI-WoT Components Library</h1>
    <p>Complete Web of Things UI library with smart components, WoT services, and declarative binding</p>
  </header>

  <section class="example-section">
    <h2>üì¶ Installation & Import Examples</h2>
    
    <h3>1. Full Library Import</h3>
    <div class="code-block">
<pre><code>// Import everything (larger bundle)
import { UiToggle, UiSlider, WoTService, createBinder } from '@thingweb/ui-wot-components';

// Or with loader
import { defineCustomElements } from '@thingweb/ui-wot-components/loader';
defineCustomElements();</code></pre>
    </div>

    <h3>2. Tree-Shaken Imports (Recommended)</h3>
    <div class="code-block">
<pre><code>// Import only components you need
import { UiToggle, UiSlider } from '@thingweb/ui-wot-components/components';

// Import only services you need
import { WoTService, createBinder } from '@thingweb/ui-wot-components/services';

// Import only utilities you need
import { UiMsg, classifyTdProperty } from '@thingweb/ui-wot-components/utils';</code></pre>
    </div>

    <h3>3. CDN Usage</h3>
    <div class="code-block">
<pre><code>&lt;script type="module" src="https://unpkg.com/@thingweb/ui-wot-components/dist/ui-wot-components/ui-wot-components.esm.js"&gt;&lt;/script&gt;</code></pre>
    </div>
  </section>

  <section class="example-section">
    <h2>üéõÔ∏è Basic Component Usage</h2>
    <div class="demo-grid">
      <div>
        <h3>Simple Components</h3>
        <ui-toggle label="Power" value="true"></ui-toggle>
        <ui-slider label="Brightness" value="75" min="0" max="100"></ui-slider>
        <ui-number-picker label="Temperature" value="22" min="10" max="30"></ui-number-picker>
      </div>
      
      <div>
        <h3>Smart Property Card</h3>
        <ui-property-card
          label="Room Temperature"
          description="Current temperature sensor reading"
          status="success"
          readonly>
          <ui-text slot="control" value="22.5¬∞C"></ui-text>
        </ui-property-card>
      </div>
    </div>
  </section>

  <section class="example-section">
    <h2>üîß Programmatic API</h2>
    
    <div class="code-block">
<pre><code>// Create WoT service
import { WoTService } from '@thingweb/ui-wot-components/services';

const wot = new WoTService({
  baseUrl: 'http://localhost:8080',
  timeout: 5000,
  debug: true
});

// Load a Thing Description
await wot.loadThing('myDevice', '/api/things/device1');

// Read property
const tempMsg = await wot.readProperty('myDevice', 'temperature');
console.log('Temperature:', tempMsg.payload);

// Write property  
await wot.writeProperty('myDevice', 'brightness', 80);

// Observe property changes
const unsubscribe = await wot.observeProperty('myDevice', 'temperature', (msg) => {
  console.log('Temperature changed:', msg.payload);
});</code></pre>
    </div>

    <div id="api-demo">
      <h3>Live API Demo</h3>
      <div style="margin: 20px 0;">
        <button id="load-demo-td">Load Demo TD</button>
        <button id="read-property">Read Property</button>
        <button id="write-property">Write Property</button>
        <button id="start-observation">Start Observation</button>
        <button id="stop-observation">Stop Observation</button>
      </div>
      <div id="api-output" style="background: #f8f9fa; padding: 15px; border-radius: 4px; min-height: 100px; font-family: monospace; white-space: pre-wrap;"></div>
    </div>
  </section>

  <section class="example-section">
    <h2>üîó Declarative Binding</h2>
    
    <h3>HTML Attribute Binding</h3>
    <div class="code-block">
<pre><code>&lt;!-- Simple binding --&gt;
&lt;ui-toggle data-wot-bind="device1.power" data-wot-two-way&gt;&lt;/ui-toggle&gt;

&lt;!-- Advanced binding with polling interval --&gt;
&lt;ui-slider 
  data-wot-bind="device1.brightness" 
  data-wot-two-way 
  data-wot-interval="1000"&gt;
&lt;/ui-slider&gt;

&lt;!-- JSON configuration --&gt;
&lt;ui-text data-wot-bind='{"thingId": "device1", "property": "temperature", "transform": "value => value + \"¬∞C\""}'&gt;&lt;/ui-text&gt;</code></pre>
    </div>

    <h3>Live Binding Demo</h3>
    <div class="demo-grid">
      <div>
        <h4>Bound Controls</h4>
        <ui-toggle id="bound-toggle" label="Device Power" data-wot-bind="demo.power" data-wot-two-way></ui-toggle>
        <ui-slider id="bound-slider" label="Brightness" data-wot-bind="demo.brightness" data-wot-two-way></ui-slider>
        <ui-text id="bound-status" label="Status" data-wot-bind="demo.status" readonly></ui-text>
      </div>
      
      <div>
        <h4>Programmatic Binding</h4>
        <div style="margin: 10px 0;">
          <button id="start-binding">Start Binding</button>
          <button id="stop-binding">Stop Binding</button>
        </div>
        <div id="binding-status">Not connected</div>
      </div>
    </div>
  </section>

  <section class="example-section">
    <h2>üé® Advanced Features</h2>
    
    <h3>Custom Transform Functions</h3>
    <div class="code-block">
<pre><code>import { createBinder } from '@thingweb/ui-wot-components/services';

const binder = createBinder(wotService);

// Bind with custom transformations
await binder.bind({
  thingId: 'sensor',
  property: 'temperature',
  target: '#temp-display',
  transform: (celsius) => `${celsius}¬∞C (${celsius * 9/5 + 32}¬∞F)`,
  validate: (value) => value >= -40 && value <= 125,
  onError: (error) => console.error('Temperature binding error:', error)
});</code></pre>
    </div>

    <h3>Thing Description Classification</h3>
    <div class="code-block">
<pre><code>import { classifyTdProperty } from '@thingweb/ui-wot-components/utils';

const capabilities = classifyTdProperty(propertySchema);
console.log('Capabilities:', capabilities); // { canRead: true, canWrite: false, canObserve: true }</code></pre>
    </div>

    <h3>Smart Property Cards</h3>
    <ui-property-card
      label="Smart Thermostat"
      description="Temperature control with advanced features"
      status="success"
      has-actions
      thing-id="thermostat">
      <ui-number-picker slot="control" value="22" min="10" max="30"></ui-number-picker>
    </ui-property-card>
  </section>

  <section class="example-section">
    <h2>üìä Event System</h2>
    <div id="event-demo">
      <h3>UiMsg Event Monitoring</h3>
      <div style="margin: 20px 0;">
        <button id="trigger-event">Trigger Event</button>
        <button id="clear-events">Clear Log</button>
      </div>
      <div id="event-log" style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 4px; font-family: monospace; max-height: 300px; overflow-y: auto;"></div>
    </div>
  </section>

  <section class="example-section">
    <h2>üí° Usage Patterns</h2>
    
    <h3>1. Simple Dashboard</h3>
    <div class="code-block">
<pre><code>// Perfect for quick prototypes
&lt;ui-property-card label="Temperature"&gt;
  &lt;ui-text slot="control" data-wot-bind="sensor.temperature"&gt;&lt;/ui-text&gt;
&lt;/ui-property-card&gt;</code></pre>
    </div>

    <h3>2. Production Applications</h3>
    <div class="code-block">
<pre><code>import { WoTService, createBinder } from '@thingweb/ui-wot-components/services';

class IoTDashboard {
  private wot = new WoTService({ debug: false });
  private binder = createBinder(this.wot);
  
  async initialize() {
    await this.wot.loadThing('building', '/api/building.jsonld');
    await this.setupBindings();
  }
}</code></pre>
    </div>

    <h3>3. Framework Integration</h3>
    <div class="code-block">
<pre><code>// React
import { UiToggle } from '@thingweb/ui-wot-components/components';

function MyComponent() {
  return &lt;UiToggle label="Power" onUiChange={handleChange} /&gt;;
}

// Vue  
import { UiSlider } from '@thingweb/ui-wot-components/components';

export default {
  components: { UiSlider },
  template: '&lt;UiSlider @uiChange="handleChange" /&gt;'
}</code></pre>
    </div>
  </section>

  <footer style="margin-top: 60px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
    <p>üìò <strong>Documentation:</strong> Visit the full documentation for detailed API reference and examples.</p>
    <p>üîß <strong>Bundle Size:</strong> Tree-shaking reduces bundle size by ~75% when importing only needed components.</p>
    <p>üåê <strong>Web of Things:</strong> Fully compatible with W3C WoT Thing Description specifications.</p>
  </footer>

  <script type="module">
    // Demo Thing Description for testing
    const demoTD = {
      "@context": "https://www.w3.org/2019/wot/td/v1",
      "id": "urn:demo:device",
      "title": "Demo IoT Device",
      "properties": {
        "power": {
          "type": "boolean",
          "observable": true,
          "forms": [{ "href": "/api/power", "op": ["readproperty", "writeproperty"] }]
        },
        "brightness": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "observable": true,
          "forms": [{ "href": "/api/brightness", "op": ["readproperty", "writeproperty"] }]
        },
        "temperature": {
          "type": "number",
          "unit": "celsius",
          "readOnly": true,
          "observable": true,
          "forms": [{ "href": "/api/temperature", "op": ["readproperty"] }]
        },
        "status": {
          "type": "string",
          "enum": ["idle", "active", "error"],
          "readOnly": true,
          "forms": [{ "href": "/api/status", "op": ["readproperty"] }]
        }
      }
    };

    // Mock device state
    let deviceState = {
      power: false,
      brightness: 50,
      temperature: 22.5,
      status: 'idle'
    };

    // Mock WoT service for demo
    class MockWoTService {
      constructor() {
        this.things = new Map();
        this.eventTarget = new EventTarget();
      }

      async loadThing(thingId, td) {
        this.things.set(thingId, { td, state: deviceState });
        this.log(`Loaded thing: ${thingId}`);
        return Promise.resolve();
      }

      async readProperty(thingId, property) {
        const thing = this.things.get(thingId);
        const value = thing?.state[property];
        const msg = {
          payload: value,
          ts: Date.now(),
          source: `${thingId}.${property}`,
          ok: true
        };
        this.log(`Read ${thingId}.${property} = ${value}`);
        return msg;
      }

      async writeProperty(thingId, property, value) {
        const thing = this.things.get(thingId);
        if (thing) {
          thing.state[property] = value;
          this.log(`Write ${thingId}.${property} = ${value}`);
        }
        return {
          payload: value,
          ts: Date.now(),
          source: `${thingId}.${property}`,
          ok: true
        };
      }

      async observeProperty(thingId, property, callback) {
        this.log(`Started observing ${thingId}.${property}`);
        
        // Simulate periodic updates
        const interval = setInterval(() => {
          const thing = this.things.get(thingId);
          if (thing) {
            // Simulate value changes
            if (property === 'temperature') {
              thing.state.temperature += (Math.random() - 0.5) * 0.5;
              thing.state.temperature = Math.round(thing.state.temperature * 10) / 10;
            }
            
            callback({
              payload: thing.state[property],
              ts: Date.now(),
              source: `${thingId}.${property}`,
              ok: true
            });
          }
        }, 2000);

        return () => {
          clearInterval(interval);
          this.log(`Stopped observing ${thingId}.${property}`);
        };
      }

      log(message) {
        const output = document.getElementById('api-output');
        if (output) {
          output.textContent += `[${new Date().toLocaleTimeString()}] ${message}\n`;
          output.scrollTop = output.scrollHeight;
        }
      }
    }

    // Initialize demo
    const mockWoT = new MockWoTService();
    let currentObserver = null;

    // API Demo handlers
    document.getElementById('load-demo-td')?.addEventListener('click', async () => {
      try {
        await mockWoT.loadThing('demo', demoTD);
      } catch (error) {
        mockWoT.log(`Error: ${error.message}`);
      }
    });

    document.getElementById('read-property')?.addEventListener('click', async () => {
      try {
        const msg = await mockWoT.readProperty('demo', 'temperature');
        mockWoT.log(`Value: ${msg.payload}`);
      } catch (error) {
        mockWoT.log(`Error: ${error.message}`);
      }
    });

    document.getElementById('write-property')?.addEventListener('click', async () => {
      try {
        const newValue = Math.random() > 0.5;
        await mockWoT.writeProperty('demo', 'power', newValue);
      } catch (error) {
        mockWoT.log(`Error: ${error.message}`);
      }
    });

    document.getElementById('start-observation')?.addEventListener('click', async () => {
      try {
        if (currentObserver) {
          currentObserver();
        }
        currentObserver = await mockWoT.observeProperty('demo', 'temperature', (msg) => {
          mockWoT.log(`Observed: ${msg.payload}¬∞C`);
        });
      } catch (error) {
        mockWoT.log(`Error: ${error.message}`);
      }
    });

    document.getElementById('stop-observation')?.addEventListener('click', () => {
      if (currentObserver) {
        currentObserver();
        currentObserver = null;
        mockWoT.log('Stopped observation');
      }
    });

    // Event monitoring
    let eventCounter = 0;
    document.getElementById('trigger-event')?.addEventListener('click', () => {
      const eventLog = document.getElementById('event-log');
      const event = {
        type: 'uiChange',
        detail: {
          payload: Math.floor(Math.random() * 100),
          ts: Date.now(),
          source: 'demo-component',
          ok: true,
          counter: ++eventCounter
        }
      };
      
      if (eventLog) {
        eventLog.textContent += `${JSON.stringify(event, null, 2)}\n\n`;
        eventLog.scrollTop = eventLog.scrollHeight;
      }
    });

    document.getElementById('clear-events')?.addEventListener('click', () => {
      const eventLog = document.getElementById('event-log');
      if (eventLog) eventLog.textContent = '';
      const output = document.getElementById('api-output');
      if (output) output.textContent = '';
    });

    // Component event listeners
    document.addEventListener('uiChange', (event) => {
      console.log('UI Change:', event.detail);
    });

    // Initialize with demo data
    setTimeout(() => {
      mockWoT.loadThing('demo', demoTD);
    }, 1000);
  </script>
</body>
</html>
